<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Humble Choice Countdown</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0d0d0d;
      color: #f0f0f0;
      text-align: center;
      margin-top: 10%;
    }
    h1 { font-size: 2em; margin-bottom: 0.5em; }
    #countdown { font-size: 2em; margin-bottom: 0.5em; }
    #target, #timezone { color: #aaa; font-size: 1em; }
  </style>
</head>
<body>
  <h1>Next Humble Choice Reveal</h1>
  <div id="countdown">Loading…</div>
  <div id="target"></div>
  <div id="timezone"></div>

  <script>
    // --- 1️⃣ Helper: find the first Tuesday of a given month ---
    function firstTuesday(year, month) {
      const d = new Date(Date.UTC(year, month, 1));
      while (d.getUTCDay() !== 2) { // 0=Sun, 1=Mon, 2=Tue
        d.setUTCDate(d.getUTCDate() + 1);
      }
      return d;
    }

    // --- 2️⃣ Find the next event date ---
    const now = new Date();
    let event = firstTuesday(now.getUTCFullYear(), now.getUTCMonth());
    if (now > new Date(event)) {
      // Already passed this month's first Tuesday, move to next month
      event = firstTuesday(now.getUTCFullYear(), now.getUTCMonth() + 1);
    }

    // --- 3️⃣ Set target time: 10 AM PT (Pacific Time) ---
    // PT offset changes with DST; use locale-based conversion
    const eventPT = new Date(
      new Intl.DateTimeFormat('en-US', {
        timeZone: 'America/Los_Angeles',
        year: 'numeric', month: 'numeric', day: 'numeric'
      }).format(event)
    );
    eventPT.setHours(10, 0, 0, 0);

    // Convert PT time to UTC timestamp for countdown
    const targetUTC = new Date(
      eventPT.toLocaleString('en-US', { timeZone: 'UTC' })
    );

    // --- 4️⃣ Update countdown every second ---
    const countdownEl = document.getElementById('countdown');
    const targetEl = document.getElementById('target');
    const tzEl = document.getElementById('timezone');

    function updateCountdown() {
      const nowUTC = new Date();
      const diff = targetUTC - nowUTC;
      if (diff <= 0) {
        countdownEl.textContent = "Humble Choice is live!";
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const mins = Math.floor((diff / (1000 * 60)) % 60);
      const secs = Math.floor((diff / 1000) % 60);

      countdownEl.textContent = `${days}d ${hours}h ${mins}m ${secs}s`;
    }

    // Show event info
    targetEl.textContent = `Next reveal: ${eventPT.toLocaleString('en-US', {
      timeZone: 'America/Los_Angeles',
      dateStyle: 'full',
      timeStyle: 'short'
    })} (PT)`;

    tzEl.textContent = `Your local time zone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`;

    updateCountdown();
    setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
